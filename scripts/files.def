#!/bin/bash
# Copyright (c) 2021, 2022 Logic Magicians Software
#
# Source file file.
#
#

# The base Oberon operating system.
#
# This list must be kept in 'import order' so
# that each module can be compiled.
declare -a OS;
OS=(lms/Kernel.Mod                              \
    lms/HostOS.Mod                              \
    Reals.Mod                                   \
    lms/Console.Mod                             \
    lms/Environment.Mod                         \
    lms/Pathnames.Mod                           \
    lms/GetOpt.Mod                              \
    lms/FileDir.Mod                             \
    Files.Mod                                   \
    lms/FileUtils.Mod                           \
    lms/DebugIO.Mod                             \
    lms/ModuleInspector.Mod                     \
    lms/Trap.Mod                                \
    lms/CommandLine.Mod                         \
    lms/Modules.Mod                             \
    Types.Mod                                   \
    Objects.Mod                                 \
    Input.Mod                                   \
    Display.Mod                                 \
    DisplayFrame.Mod                            \
    Fonts.Mod                                   \
    Texts.Mod                                   \
    Viewers.Mod                                 \
    Oberon.Mod                                  \
    MenuViewers.Mod                             \
    TextFrames.Mod                              \
    s3.System.Mod                               \
    lms/KernelTD.Mod);


# The SKL compiler.
declare -a SKL;
SKL=(compiler/skl/SKLERR.Mod                    \
     compiler/skl/SKLCMDIO.Mod                  \
     compiler/skl/SKLMD.Mod                     \
     compiler/skl/SKLOS.Mod                     \
     compiler/skl/SKLST.Mod                     \
     compiler/skl/SKLIE.Mod                     \
     compiler/skl/SKLT.Mod                      \
     compiler/skl/SKLTB.Mod                     \
     compiler/skl/SKLDN.Mod                     \
     compiler/skl/SKLDS.Mod                     \
     compiler/skl/SKLCGL.Mod                    \
     compiler/skl/SKLCGH.Mod                    \
     compiler/skl/SKLTH.Mod                     \
     compiler/skl/SKLTT.Mod                     \
     compiler/skl/SKLPU.Mod                     \
     compiler/skl/SKLTU.Mod                     \
     compiler/skl/SKLSTP.Mod                    \
     compiler/skl/SKLE.Mod                      \
     compiler/skl/SKLSP.Mod                     \
     compiler/skl/SKL.Mod);

# The compiler called O3

declare -a O3;                                  \
O3=(compiler/o3/O3Errors.Mod                    \
    compiler/o3/O3Config.Mod                    \
    compiler/o3/O3MachineDep.Mod                \
    compiler/o3/O3Scanner.Mod                   \
    compiler/o3/O3Symtab.Mod                    \
    compiler/o3/O3Fingerprint.Mod               \
    compiler/o3/O3SymFile.Mod                   \
    compiler/o3/O3TreeNode.Mod                  \
    compiler/o3/O3TreeHelper.Mod                \
    compiler/o3/O3Semantics.Mod                 \
    compiler/o3/O3ConstExpression.Mod           \
    compiler/o3/O3TypeAllocate.Mod              \
    compiler/o3/O3StdProc.Mod                   \
    compiler/o3/O3Expression.Mod                \
    compiler/o3/O3Parser.Mod                    \
    compiler/o3/O3.Mod                          \
    compiler/o3/O3IOCommand.Mod                 \
    compiler/o3/O3FileIO.Mod                    \
    compiler/o3/O3GSAOpcode.Mod                 \
    compiler/o3/O3GSAData.Mod                   \
    compiler/o3/O3GSANames.Mod                  \
    compiler/o3/O3GSADump.Mod                   \
    compiler/o3/O3GSACanon.Mod                  \
    compiler/o3/O3GSADeadCode.Mod               \
    compiler/o3/O3GSAValueNumber.Mod            \
    compiler/o3/O3GSAConstPropagate.Mod         \
    compiler/o3/O3GSAAliasAnalysis.Mod          \
    compiler/o3/O3GSACopyPropagate.Mod          \
    compiler/o3/O3GSASimpleSchedule.Mod         \
    compiler/o3/O3GSAImprove.Mod                \
    compiler/o3/O3MGSA.Mod                      \
    compiler/o3/O3Mi386.Mod                     \
    compiler/o3/O3MTreeDumper.Mod);




# The tests for the SKL compiler code generator.
#
# The key is the name of the test module.
#
# The value of each element in the dictionary contains attributes about the test:
#
#   o 'pass' means the test succeeds to 'pass'. Mutually exclusive with 'fail'.
#
#   o 'fail' means the test fails to 'pass'.  Mutually exclusive with 'pass'.
#
#   o 'manual' means the test is only run manually (due to long runtimes).
#
declare -A COMPILER_TESTS;
COMPILER_TESTS=(                                        \
    [compiler/skl/tests/CTArrayTrap.Mod]="pass"         \
    [compiler/skl/tests/CTAssertTrap.Mod]="fail"        \
    [compiler/skl/tests/CTBitsetRangeFail.Mod]="fail"   \
    [compiler/skl/tests/CTConditionCode.Mod]="pass"     \
    [compiler/skl/tests/CTDivZero.Mod]="fail"           \
    [compiler/skl/tests/CTDumpHeap.Mod]="pass,manual"   \
    [compiler/skl/tests/CTDynArrLength.Mod]="fail"      \
    [compiler/skl/tests/CTEmpty.Mod]="pass,manual"      \
    [compiler/skl/tests/CTEnvironment.Mod]="pass"       \
    [compiler/skl/tests/CTExclude.Mod]="pass"           \
    [compiler/skl/tests/CTFileIO.Mod]="pass"            \
    [compiler/skl/tests/CTFingerprint.Mod]="pass"       \
    [compiler/skl/tests/CTFor.Mod]="pass"               \
    [compiler/skl/tests/CTGC.Mod]="pass,manual"         \
    [compiler/skl/tests/CTGetOpt.Mod]="pass,manual"     \
    [compiler/skl/tests/CTImport.Mod]="pass"            \
    [compiler/skl/tests/CTIncDec.Mod]="pass"            \
    [compiler/skl/tests/CTInstructionCount.Mod]="pass"  \
    [compiler/skl/tests/CTInvalidOpcode.Mod]="fail"     \
    [compiler/skl/tests/CTMissingMethod.Mod]="fail"     \
    [compiler/skl/tests/CTNest.Mod]="pass"              \
    [compiler/skl/tests/CTOOBRead.Mod]="fail"           \
    [compiler/skl/tests/CTOOBWrite.Mod]="fail"          \
    [compiler/skl/tests/CTOpenArray.Mod]="pass"         \
    [compiler/skl/tests/CTPathnames.Mod]="pass"         \
    [compiler/skl/tests/CTProcedure.Mod]="pass"         \
    [compiler/skl/tests/CTRange.Mod]="fail"             \
    [compiler/skl/tests/CTReal.Mod]="pass"              \
    [compiler/skl/tests/CTReturn.Mod]="pass"            \
    [compiler/skl/tests/CTRotate.Mod]="pass"            \
    [compiler/skl/tests/CTSET.Mod]="pass"               \
    [compiler/skl/tests/CTSetCtor.Mod]="pass"           \
    [compiler/skl/tests/CTString.Mod]="pass"            \
    [compiler/skl/tests/CTTDCodeGen.Mod]="pass"         \
    [compiler/skl/tests/CTTrapNil.Mod]="fail"           \
    [compiler/skl/tests/CTTypeDesc.Mod]="pass,manual"   \
);

# Tests for modules.
#
# The key is the name of the test module.
#
# The value of each element in the dictionary contains attributes about the test:
#
#   o 'pass' means the test succeeds to 'pass'. Mutually exclusive with 'fail'.
#
#   o 'fail' means the test fails to 'pass'.  Mutually exclusive with 'pass'.
#
#   o 'manual' means the test is only run manually (due to long runtimes).
#
declare -A MODULE_TESTS;
MODULE_TESTS=(                                  \
    [lms/tests/MkTree.Mod]="pass"               \
);
